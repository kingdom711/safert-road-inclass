---
description: Safety Road REST API 설계 표준 및 컨벤션
globs: ["**/*Controller.java", "**/*.tsx", "**/*.ts"]
alwaysApply: false
---
# REST API Design Rules - Safety Road

## 1. Resource Naming (URL 구조)
- **Base URL**: `/api/v1` (버전 관리)
- **Plural Nouns**: 복수형 명사 사용 (e.g., `/api/v1/checklists`)
- **Kebab-case**: URL에는 하이픈 사용 (e.g., `/api/v1/checklist-templates`)
- **NO Verbs**: 동사 사용 금지 (e.g., ❌ `/createChecklist`, ✅ `POST /checklists`)

### Safety Road API 예시
```
POST   /api/v1/auth/login              # 로그인
POST   /api/v1/auth/refresh            # 토큰 갱신

GET    /api/v1/templates                # 템플릿 목록 조회
GET    /api/v1/templates/{id}           # 특정 템플릿 상세

POST   /api/v1/checklists               # 체크리스트 제출
GET    /api/v1/checklists               # 내 체크리스트 목록
GET    /api/v1/checklists/{id}          # 체크리스트 상세

POST   /api/v1/checklists/{id}/review   # 검토 및 승인/반려
POST   /api/v1/checklists/{id}/photos   # 사진 업로드

GET    /api/v1/risks/pending            # 위험성 평가 대상 조회
POST   /api/v1/risks/{id}/assess        # 위험성 평가 등록

POST   /api/v1/ai/analyze               # AI 사진 분석 요청

GET    /api/v1/notifications            # 알림 목록 조회
GET    /api/v1/notifications/subscribe  # SSE 구독
```

## 2. HTTP Methods
- **GET**: 리소스 조회 (Safe & Idempotent)
- **POST**: 리소스 생성 또는 액션 실행 (Not Idempotent)
- **PUT**: 전체 업데이트 (Idempotent, 사용 빈도 낮음)
- **PATCH**: 부분 업데이트 (e.g., 상태 변경)
- **DELETE**: 리소스 삭제 (Idempotent)

## 3. Request/Response Standards

### JSON Property Naming
- **camelCase** 사용 (e.g., `firstName`, `checklistId`, `createdAt`)
- **Date/Time Format**: ISO-8601 (`yyyy-MM-dd'T'HH:mm:ss.SSSXXX`)
  - 예: `"2025-12-06T14:30:00.000+09:00"`

### Request Body 예시
```json
{
  "templateId": 1,
  "workDate": "2025-12-06",
  "siteName": "삼성전자 기흥캠퍼스",
  "items": [
    {
      "itemId": 1,
      "answer": "yes",
      "comment": ""
    },
    {
      "itemId": 2,
      "answer": "no",
      "comment": "사다리 고정 미흡"
    }
  ]
}
```

### Response Envelope (통일된 응답 구조)
**성공 시**:
```json
{
  "success": true,
  "data": {
    "id": 123,
    "status": "submitted",
    "createdAt": "2025-12-06T14:30:00.000+09:00"
  },
  "error": null
}
```

**실패 시**:
```json
{
  "success": false,
  "data": null,
  "error": {
    "code": "INVALID_INPUT",
    "message": "필수 항목에 응답이 누락되었습니다.",
    "details": {
      "field": "items[2].answer",
      "rejectedValue": null
    }
  }
}
```

### ApiResponse 구현 예시 (Backend)
```java
@Getter
@AllArgsConstructor
@NoArgsConstructor
public class ApiResponse<T> {
    private boolean success;
    private T data;
    private ErrorDetail error;

    public static <T> ApiResponse<T> success(T data) {
        return new ApiResponse<>(true, data, null);
    }

    public static <T> ApiResponse<T> error(ErrorDetail error) {
        return new ApiResponse<>(false, null, error);
    }
}
```

## 4. HTTP Status Codes (Safety Road Context)
| Code | 상황 | 예시 |
|:---:|:---|:---|
| **200** | 성공 (조회, 수정) | GET /checklists |
| **201** | 리소스 생성 성공 | POST /checklists |
| **204** | 성공 (응답 본문 없음) | DELETE /checklists/{id} |
| **400** | 잘못된 요청 (검증 실패) | 필수 항목 누락 |
| **401** | 인증 실패 | JWT 토큰 누락/만료 |
| **403** | 권한 부족 | 작업자가 관리자 API 호출 |
| **404** | 리소스 없음 | 존재하지 않는 체크리스트 ID |
| **409** | 충돌 (상태 불일치) | 이미 승인된 체크리스트를 다시 승인 시도 |
| **500** | 서버 내부 오류 | 예상치 못한 예외 발생 |

## 5. Authentication & Authorization
- **Header**: `Authorization: Bearer {JWT_TOKEN}`
- **Public Endpoints** (인증 불필요):
  - `POST /api/v1/auth/login`
  - `POST /api/v1/auth/refresh`
- **Protected Endpoints**: 모든 나머지 API (JWT 검증 필수)
- **Role-Based Access**:
  - `ROLE_WORKER`: 체크리스트 작성/조회
  - `ROLE_SUPERVISOR`: 검토 및 승인/반려
  - `ROLE_SAFETY_MANAGER`: 전체 현황 조회, 조치 기록

## 6. Pagination & Filtering
- **Pagination** (Spring Data JPA):
  - Query Params: `?page=0&size=20&sort=createdAt,desc`
  - Response:
    ```json
    {
      "success": true,
      "data": {
        "content": [ ... ],
        "totalElements": 150,
        "totalPages": 8,
        "number": 0,
        "size": 20
      }
    }
    ```

- **Filtering**:
  - Query Params: `?status=submitted&workDate=2025-12-06`

## 7. File Upload (Multipart)
- **Endpoint**: `POST /api/v1/checklists/{id}/photos`
- **Content-Type**: `multipart/form-data`
- **Max File Size**: 10MB
- **Allowed Extensions**: `.jpg`, `.jpeg`, `.png`
- **Request**:
  ```
  POST /api/v1/checklists/123/photos
  Content-Type: multipart/form-data
  
  files: [file1.jpg, file2.jpg]
  ```
- **Response**:
  ```json
  {
    "success": true,
    "data": {
      "photoIds": [456, 457]
    }
  }
  ```

## 8. Error Handling Best Practices
- **Validation Errors**: 필드별 에러 메시지 제공
  ```json
  {
    "success": false,
    "error": {
      "code": "VALIDATION_FAILED",
      "message": "입력 값 검증 실패",
      "details": {
        "email": "이메일 형식이 올바르지 않습니다",
        "password": "비밀번호는 최소 8자 이상이어야 합니다"
      }
    }
  }
  ```

- **Business Logic Errors**:
  ```json
  {
    "success": false,
    "error": {
      "code": "CHECKLIST_ALREADY_APPROVED",
      "message": "이미 승인된 체크리스트는 수정할 수 없습니다"
    }
  }
  ```

## 9. API Documentation (Swagger/OpenAPI)
- **Swagger UI**: `http://localhost:8080/swagger-ui.html`
- **어노테이션 활용**:
  ```java
  @Tag(name = "Checklist", description = "체크리스트 관리 API")
  @RestController
  @RequestMapping("/api/v1/checklists")
  public class ChecklistController {
      
      @Operation(summary = "체크리스트 제출", description = "작업자가 점검표를 작성하여 제출합니다")
      @ApiResponses({
          @ApiResponse(responseCode = "201", description = "제출 성공"),
          @ApiResponse(responseCode = "400", description = "필수 항목 누락")
      })
      @PostMapping
      public ResponseEntity<ApiResponse<ChecklistResponse>> submit(...) { ... }
  }
  ```

## See also:
- [301-spring-boot-java-rules.cursorrules](301-spring-boot-java-rules.cursorrules)
- [303-database-mysql-jpa-rules.cursorrules](303-database-mysql-jpa-rules.cursorrules)

