---
description: Safety Road 프로젝트 개발 가이드라인 및 제약 사항
globs: ["**/*"]
alwaysApply: true
---
# Development Guidelines - Safety Road
Referenced in: [001-project-overview.cursorrules](001-project-overview.cursorrules), [002-tech-stack.cursorrules](002-tech-stack.cursorrules)

## Version Control
- **System**: Git
- **Repository**: GitHub (`kingdom711/safert-road-inclass`)
- **Branching**: Git Flow / Feature Branch Workflow
- **Commit Policy**: Conventional Commits 형식 필수 (feat, fix, chore, refactor, docs)

## Technology Constraints (C-TEC)
- **Backend Core**: Java 17 + Spring Boot 3.x (REST API)
- **Frontend**: React 18 + TypeScript + Vite (반응형 웹)
- **Database**: MySQL 8.x (InnoDB, utf8mb4)
- **AI Provider**: Google Gemini Vision API (외부 연동)
- **Authentication**: JWT 기반 인증 + Spring Security RBAC

## Architecture Principles
- **Domain-Driven Design (DDD)**:
  - 7개 도메인 (auth, template, checklist, review, risk, ai, notification)
  - 각 도메인은 Controller-Service-Repository 레이어 구조
- **Security**:
  - 모든 API는 JWT 인증 필수 (로그인/회원가입 제외)
  - 역할 기반 접근 제어 (ROLE_WORKER, ROLE_SUPERVISOR, ROLE_SAFETY_MANAGER)
  - 파일 업로드 시 확장자 검사 (이미지만 허용, 10MB 이하)
- **Reliability**:
  - 위험도 계산: 규칙 기반 로직 (빈도 x 강도)
  - AI 분석: LLM 기반 (실패 시 수동 검토 폴백)
  - 트랜잭션 관리: `@Transactional` 명시적 적용

## Performance Standards (NFR)
- **체크리스트 로딩**: 템플릿 조회 응답 시간 < 1초
- **체크리스트 제출**: API 응답 시간 < 3초 (p95)
- **AI 이미지 분석**: 사진 1장당 처리 시간 < 5초
- **대시보드 조회**: 위험 현황 리스트 로딩 < 3초
- **동시 사용자**: 50명 기준 안정적 동작

## Development Priorities
1. **법적 증빙 우선**: 모든 주요 이벤트(제출, 승인, 반려, 조치)는 감사 로그 필수
2. **모바일 UX**: 작업자는 현장에서 모바일로 사용하므로 반응형 디자인 필수
3. **데이터 무결성**: 체크리스트 상태 전이는 명확한 규칙에 따라 관리
   - `draft` → `submitted` → `approved_supervisor` → `approved_manager`
   - 반려 시 `rejected` 상태로 전환
4. **에러 처리**: 사용자 친화적 에러 메시지 제공 (전역 예외 핸들러 활용)

## Code Quality Standards
- **Backend**:
  - Lombok 활용 (보일러플레이트 코드 최소화)
  - DTO 패턴 필수 (Entity 직접 노출 금지)
  - Constructor Injection 사용 (`@RequiredArgsConstructor`)
  - 전역 예외 처리 (`@RestControllerAdvice`)
- **Frontend**:
  - 함수형 컴포넌트 + Hooks 사용
  - `any` 타입 사용 금지 (명시적 타입 선언)
  - Tailwind CSS 유틸리티 클래스 활용 (인라인 스타일 지양)

## Testing Requirements
- **Unit Tests**: Service 레이어 로직 테스트 (Mockito)
- **Integration Tests**: Controller 및 Repository 테스트 (`@SpringBootTest`)
- **E2E Tests**: 주요 사용자 플로우 (체크리스트 제출 → 승인) 검증

## Security Checklist
- [ ] 모든 API 엔드포인트에 JWT 인증 적용
- [ ] 역할별 권한 검증 (`@PreAuthorize` 또는 SecurityFilterChain)
- [ ] 비밀번호는 BCrypt로 암호화 저장
- [ ] SQL Injection 방지 (JPA Parameterized Query 활용)
- [ ] XSS 방지 (입력 값 검증 및 이스케이핑)

## Monitoring & Logging
- **Logging**: Logback 설정 (콘솔 + 파일)
  - INFO: 주요 비즈니스 이벤트 (체크리스트 제출, 승인 등)
  - ERROR: 예외 발생 시 StackTrace 포함
- **Audit Log**: 주요 행위는 별도 `audit_log` 테이블에 기록
  - 생성자/수정자 자동 기록 (`@CreatedBy`, `@LastModifiedBy`)

## See also:
- [001-project-overview.cursorrules](001-project-overview.cursorrules)
- [002-tech-stack.cursorrules](002-tech-stack.cursorrules)
- [301-spring-boot-java-rules.cursorrules](301-spring-boot-java-rules.cursorrules)
- [200-git-commit-push-pr.cursorrules](200-git-commit-push-pr.cursorrules)

