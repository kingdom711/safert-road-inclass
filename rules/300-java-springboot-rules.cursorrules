# Java & Spring Boot Development Rules

## Code Style & Conventions
- **Class Naming**: PascalCase (e.g., `ChecklistController`)
- **Method/Variable Naming**: camelCase (e.g., `findChecklistById`)
- **Constants**: UPPER_SNAKE_CASE (e.g., `MAX_RETRY_COUNT`)
- **Package Structure**: Layer-based packaging (controller, service, repository, dto, entity)

## Architecture: Layered Architecture
Strictly follow the flow: `Controller` -> `Service` -> `Repository` -> `Database`

### 1. Controller Layer (`api` package)
- **Responsibility**: Request validation, calling Service, mapping DTO to Response.
- **Rules**:
  - NEVER access Repository directly.
  - NEVER return Entity directly. Always use DTOs.
  - Use `@RestController` and `@RequestMapping`.
  - Delegate all business logic to Service.

### 2. Service Layer (`service` or `domain` package)
- **Responsibility**: Business logic, Transaction management.
- **Rules**:
  - Use `@Transactional(readOnly = true)` at class level.
  - Use `@Transactional` for write methods (create, update, delete).
  - Throw custom `BusinessException` instead of Generic Exception.

### 3. Repository Layer (`repository` package)
- **Responsibility**: Data access.
- **Rules**:
  - Use Spring Data JPA `JpaRepository`.
  - Write JPQL or QueryDSL for complex queries.

## DTO Pattern
- **Request DTO**: For `@RequestBody` or `@ModelAttribute`. Use Java Records or Classes with validation annotations (`@NotNull`, `@Size`).
- **Response DTO**: For returning data. Decouple API response from Database Entity.
- **Entity-DTO Conversion**:
  - Use static factory methods (e.g., `ChecklistResponse.from(entity)`) or MapStruct.

## Exception Handling
- Use global `@RestControllerAdvice`.
- Define `GlobalExceptionHandler` to handle:
  - `MethodArgumentNotValidException` (Validation fail)
  - `BusinessException` (Custom logic fail)
  - `Exception` (Fallback)
- Return consistent error structure: `{ "code": "ERR_001", "message": "...", "details": ... }`

## Lombok Usage
- **DO NOT USE**: `@Data` (Too heavy, risks with equals/hashCode)
- **RECOMMENDED**:
  - `@Getter`, `@NoArgsConstructor(access = AccessLevel.PROTECTED)`
  - `@ToString(exclude = "relationshipFields")` to prevent infinite recursion.
  - `@Builder` or `@AllArgsConstructor` (private) for object creation.

## Dependency Injection
- Always use **Constructor Injection** (`@RequiredArgsConstructor` + `final` fields).
- Avoid Field Injection (`@Autowired` on field).

