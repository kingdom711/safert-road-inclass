---
description: 프론트엔드-백엔드 통합 개발 규칙 및 협업 가이드라인
globs: ["**/*"]
alwaysApply: true
---
# Frontend-Backend Integration Rules

프론트엔드와 백엔드 간 API 연동 및 공동 작업을 위한 규칙입니다.

## API 통신 규칙

### Base URL 및 엔드포인트
- **Base URL**: `http://localhost:8080` (개발 환경)
- **API Prefix**: `/api/v1`
- **인증 방식**: JWT Bearer Token
- **응답 형식**: JSON

### 표준 응답 형식
모든 API는 다음 형식을 준수합니다:

```typescript
interface ApiResponse<T> {
  status: "success" | "error";
  code: number;
  message: string;
  data?: T;
}
```

### 인증 토큰 관리
- **저장 위치**: localStorage (Access Token), httpOnly Cookie (Refresh Token) 고려
- **헤더 형식**: `Authorization: Bearer {accessToken}`
- **자동 갱신**: Access Token 만료 시 Refresh Token으로 자동 갱신
- **토큰 만료 처리**: 401 응답 시 자동 로그아웃 또는 토큰 갱신 시도

## 프론트엔드 API 클라이언트 구조

### 필수 구현 사항
```
frontend/src/
├── api/
│   ├── apiClient.ts          # 공통 API 클라이언트
│   ├── authApi.ts            # 인증 API
│   ├── checklistApi.ts       # 체크리스트 API
│   ├── templateApi.ts        # 템플릿 API
│   ├── reviewApi.ts          # 검토 API
│   ├── riskApi.ts            # 위험성 평가 API
│   ├── aiApi.ts              # AI 분석 API
│   └── index.ts              # 통합 export
├── config/
│   └── environment.ts        # 환경변수 설정
└── utils/
    └── tokenManager.ts       # 토큰 관리 유틸리티
```

### API 클라이언트 필수 기능
1. **자동 인증 헤더 추가**: 저장된 토큰이 있으면 자동으로 `Authorization` 헤더 추가
2. **에러 처리**: 네트워크 에러, 타임아웃, HTTP 에러 코드별 처리
3. **로깅**: 개발 모드에서 요청/응답 로깅
4. **타임아웃**: 기본 30초, 설정 가능

## 환경 변수 관리

### 프론트엔드 환경 변수 (.env)
```env
VITE_API_BASE_URL=http://localhost:8080
VITE_USE_MOCK=false
VITE_API_TIMEOUT=30000
VITE_DEV_MODE=true
```

### 백엔드 프로파일
- **개발**: `dev` (H2 In-Memory DB)
- **운영**: `mysql` (MySQL 8.x)

## CORS 설정

### 백엔드 허용 Origin
- 개발 환경: `http://localhost:5173`, `http://localhost:3000`
- 프로덕션: 실제 도메인으로 변경

### 프론트엔드 프록시 설정
Vite 개발 서버 프록시 사용:
```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true,
    }
  }
}
```

## 에러 처리 규칙

### 프론트엔드 에러 처리
- **네트워크 에러**: 사용자 친화적 메시지 표시
- **401 Unauthorized**: 자동 로그아웃 또는 토큰 갱신 시도
- **403 Forbidden**: 권한 없음 메시지 표시
- **404 Not Found**: 리소스를 찾을 수 없음 메시지
- **500 Server Error**: 서버 오류 메시지 및 재시도 옵션

### 백엔드 에러 응답
- 모든 에러는 `ApiResponse` 형식으로 반환
- 에러 코드는 `ErrorCode` enum 사용
- 스택 트레이스는 프로덕션 환경에서 제외

## API 변경 사항 통지

### Breaking Change 처리
- API 변경 시 버전 관리 (예: `/api/v2/`)
- 또는 Swagger 문서 업데이트 및 프론트엔드 팀 통지

### 문서화
- 모든 API는 Swagger 문서화 필수
- 주요 변경 사항은 `BACKEND_INTEGRATION_GUIDE.md` 업데이트

## 공동 작업 규칙

### 브랜치 전략
- **기능 브랜치**: `feat/{feature-name}`
- **통합 브랜치**: `feat/deploy-n-integration`
- **메인 브랜치**: `main` (배포 가능한 안정 버전)

### 커밋 메시지
Conventional Commits 형식:
```
feat: 새로운 기능 추가
fix: 버그 수정
docs: 문서 수정
refactor: 코드 리팩토링
```

### 코드 리뷰
- 모든 PR은 최소 1명의 리뷰어 승인 필요
- API 변경 사항은 양쪽 팀 모두 확인

## 테스트 규칙

### 프론트엔드 테스트
- API 호출은 Mock 데이터로 테스트
- 통합 테스트는 실제 백엔드 서버와 연동

### 백엔드 테스트
- Swagger UI를 통한 API 테스트
- Postman 또는 Thunder Client 사용

## 성능 기준

### API 응답 시간
- 체크리스트 로딩: < 1초
- 체크리스트 제출: < 3초 (p95)
- AI 이미지 분석: < 5초
- 대시보드 조회: < 3초

### 동시 사용자
- 개발 환경: 10명 기준
- 프로덕션: 50명 기준 안정적 동작

## 보안 규칙

### 인증 토큰
- Access Token: 짧은 만료 시간 (예: 15분)
- Refresh Token: 긴 만료 시간 (예: 7일)
- 토큰은 HTTPS로만 전송

### 민감 정보
- API Key는 환경 변수로 관리
- `.env` 파일은 `.gitignore`에 포함
- 프로덕션 환경 변수는 별도 관리

## 참고 문서
- [통합 계획서](../../INTEGRATION_PLAN.md)
- [백엔드 통합 가이드](../docs/BACKEND_INTEGRATION_GUIDE.md)
- [API 구조 가이드](../../study-demo/Docs/API_STRUCTURE.md)

